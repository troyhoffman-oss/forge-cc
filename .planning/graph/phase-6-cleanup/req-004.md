---
id: req-004
title: "Delete milestone tests and update remaining test fixtures"
group: "deletion"
dependsOn:
  - req-003
files:
  creates: []
  modifies:
    - tests/runner/loop.test.ts
    - tests/runner/prompt.test.ts
    - tests/runner/detect.test.ts
    - tests/state/status.test.ts
    - tests/integration/integration.test.ts
acceptance:
  - "tests/runner/loop.test.ts is deleted (only tested runRalphLoop milestone path)"
  - "tests/runner/detect.test.ts is deleted (tested dual-format detection, which no longer exists)"
  - "tests/runner/prompt.test.ts removes readMilestoneSection and buildPrompt tests; keeps buildRequirementPrompt tests"
  - "tests/state/status.test.ts is deleted entirely (tested PRDStatus read/write/discover which are all deleted)"
  - "tests/integration/integration.test.ts removes milestone-based integration tests; keeps graph-based tests if any"
  - "npm test passes with zero failures"
---

## Context
With the milestone code deleted in req-001 through req-003, the corresponding tests now reference deleted exports and will fail to compile. This requirement cleans up the test suite.

## Technical Approach
1. **Delete entirely:**
   - `tests/runner/loop.test.ts` — Only tests `runRalphLoop`. The graph loop tests are in `tests/runner/graph-loop.test.ts`.
   - `tests/runner/detect.test.ts` — Tests `detectFormat()` which is deleted.
   - `tests/state/status.test.ts` — Tests `readStatus`, `writeStatus`, `updateMilestoneStatus`, `discoverStatuses`, `findNextPending`, `prdStatusSchema` — all deleted.

2. **Modify:**
   - `tests/runner/prompt.test.ts` — Delete the `readMilestoneSection` and `buildPrompt` describe blocks (lines 49-221). Keep the `buildRequirementPrompt` describe block (lines 223-337). Remove unused imports (`readMilestoneSection`, `buildPrompt`). Remove the `samplePRD` constant and temp dir helpers if no longer needed.
   - `tests/integration/integration.test.ts` — This file tests the milestone-based Ralph loop end-to-end. Delete all milestone integration tests. If there are graph-based integration tests, keep them. If the entire file is milestone-only, delete it.

3. Run `npm test` to confirm zero failures.

## Interview Notes
graph-loop.test.ts already exists and covers the graph runner path. The milestone-specific test files are pure dead code after the source deletions.
