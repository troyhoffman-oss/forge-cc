---
id: req-006
title: "Implement codex-poll CLI command"
group: "feature"
dependsOn: []
files:
  creates:
    - src/codex-poll.ts
  modifies:
    - src/cli.ts
acceptance:
  - "npx forge codex-poll --owner <owner> --repo <repo> --pr <number> runs successfully"
  - "Polls GitHub PR for Codex review comments every 60s for up to 8 minutes"
  - "Exits early with JSON output when review comments are detected"
  - "Non-zero exit code and error JSON if no review found after timeout"
---

## Context
The `forge:build` skill references a `codex-poll` CLI command for polling GitHub PRs for Codex (OpenAI) review comments. The command doesn't exist yet. It needs to poll the GitHub API for PR review comments, filtering for ones from Codex, and output them as JSON.

## Technical Approach
1. Create `src/codex-poll.ts` with the poll logic:
   - Use `GITHUB_TOKEN` env var for authentication
   - Call GitHub REST API: `GET /repos/{owner}/{repo}/pulls/{pr}/comments` and `GET /repos/{owner}/{repo}/pulls/{pr}/reviews`
   - Filter for comments/reviews from Codex (check `user.login` for codex-related bot accounts, or `performed_via_github_app` for the Codex app)
   - Poll every 60 seconds, max 8 minutes (8 polls)
   - On detection: output JSON `{ found: true, comments: [...] }` and exit 0
   - On timeout: output JSON `{ found: false, error: "No Codex review found after 8 minutes" }` and exit 1

2. Use Node.js built-in `fetch` (available in Node 18+) — no new dependencies.

3. Register in `src/cli.ts`:
   ```typescript
   program
     .command('codex-poll')
     .description('Poll GitHub PR for Codex review comments')
     .requiredOption('--owner <owner>', 'Repository owner')
     .requiredOption('--repo <repo>', 'Repository name')
     .requiredOption('--pr <number>', 'PR number')
     .action(async (opts) => {
       const { pollForCodexReview } = await import('./codex-poll.js');
       await pollForCodexReview(opts);
     });
   ```

## Interview Notes
User confirmed: GITHUB_TOKEN from env var. 4 acceptance criteria. No new npm dependencies — use built-in fetch.
