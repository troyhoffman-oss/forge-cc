---
id: req-007
title: "Validation gate — line count, test suite, graph-only run"
group: "validation"
dependsOn:
  - req-004
  - req-005
  - req-006
files:
  creates: []
  modifies: []
acceptance:
  - "npm run build succeeds with zero errors"
  - "npm test passes — zero failures, zero skipped"
  - "src/ line count is less than the pre-cleanup baseline of 3,981 lines"
  - "npx forge run --prd <slug> dispatches to graph loop without detectFormat"
---

## Context
This is the final validation gate. All deletion, bugfix, and feature work is complete. This requirement verifies the codebase is clean, tests pass, and the graph-only path works.

## Technical Approach
1. Run `npm run build` — must succeed
2. Run `npm test` — must pass with zero failures
3. Count src/ lines: `find src/ -name '*.ts' | xargs wc -l` — total must be < 3,981
4. Verify `src/runner/detect.ts` does not exist
5. Verify `src/cli.ts` has no reference to `detectFormat`
6. Verify `src/types.ts` has no `MilestoneStatus` or `PRDStatus`
7. Verify `src/runner/loop.ts` exports only `runGraphLoop` (no `runRalphLoop`)

This is a verification-only requirement — no code changes.

## Interview Notes
User's primary metric: net line count decrease. The baseline is 3,981 lines. The deletion of ~210 lines of milestone code (runRalphLoop, readMilestoneSection, buildPrompt, detect.ts, milestone types/status) minus the ~80 lines added (codex-poll) should yield a net decrease.
