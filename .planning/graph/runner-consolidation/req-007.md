---
id: req-007
title: "Build skill adds hook definitions in frontmatter"
group: Build Skill Integration
dependsOn:
  - req-001
  - req-002
  - req-003
files:
  creates: []
  modifies:
    - skills/forge-build.md
acceptance:
  - "Build skill has YAML frontmatter defining WorktreeCreate, PreToolUse, and PostToolUse hooks"
  - "Hooks are scoped to the build skill's lifecycle (only fire during forge:build)"
  - "The Linear State Reference section is updated to reflect that hooks handle transitions automatically"
  - "Skill removes manual Linear sync instructions that are now handled by hooks"
---

## Context
Claude Code supports hooks defined in skill frontmatter — these hooks only fire while the skill is active and are cleaned up when it finishes. The build skill should define the Linear lifecycle hooks in its frontmatter so they fire automatically during forge:build without requiring global installation.

## Technical Approach
1. Add YAML frontmatter to `skills/forge-build.md`:
   ```yaml
   ---
   name: forge-build
   hooks:
     WorktreeCreate:
       - hooks:
           - type: command
             command: "node \"$CLAUDE_PROJECT_DIR/node_modules/forge-cc/hooks/linear-worktree-create.js\""
     PreToolUse:
       - matcher: "Bash"
         hooks:
           - type: command
             command: "node \"$CLAUDE_PROJECT_DIR/node_modules/forge-cc/hooks/linear-branch-enforce.js\""
     PostToolUse:
       - matcher: "Bash"
         hooks:
           - type: command
             command: "node \"$CLAUDE_PROJECT_DIR/node_modules/forge-cc/hooks/linear-post-action.js\""
             async: true
   ---
   ```

2. Update the Linear State Reference section to reflect automatic transitions:
   - Remove "Forge links issues to branches via syncRequirementStart" — now handled by WorktreeCreate hook
   - Add note: "Issue transitions are handled automatically by hooks and Linear's GitHub integration"
   - Remove manual `syncGraphProjectReview` call from Step 6 — now handled by PostToolUse hook on `gh pr create`

3. Simplify Step 6 (Ship): remove the `npx forge linear ship` instruction — the PostToolUse hook handles this automatically when the agent creates a PR

4. If frontmatter hooks don't work for command-directory skills, fall back to req-008 (global installation via forge setup)

## Interview Notes
- Frontmatter hooks are documented as a supported location
- Skills in ~/.claude/commands/ should support frontmatter — needs verification
- Fallback: req-008 installs hooks globally via forge setup if frontmatter doesn't work
- The PostToolUse hook should be async so it doesn't block PR creation
