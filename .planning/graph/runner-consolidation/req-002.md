---
id: req-002
title: "PreToolUse Bash hook — manual branch name rewriting"
group: Hook Infrastructure
dependsOn: []
files:
  creates:
    - hooks/linear-branch-enforce.js
  modifies: []
acceptance:
  - "When agent runs git checkout -b or git switch -c, the hook rewrites the branch name to include the Linear issue identifier via updatedInput"
  - "If the branch name already contains a Linear identifier (FRG-xxx), the hook does not modify it"
  - "If the hook cannot resolve the requirement context, it allows the original command through unchanged"
  - "The hook bails out in under 10ms for non-matching Bash commands (not git branch creation)"
---

## Context
Agents may create branches manually via `git checkout -b` instead of using the Task tool with `isolation: "worktree"`. This hook catches those cases and rewrites the branch name to include the Linear issue identifier, enabling Linear's native GitHub auto-linking.

## Technical Approach
1. Create `hooks/linear-branch-enforce.js` as a PreToolUse command hook with matcher `Bash`
2. Read stdin JSON, extract `tool_input.command`
3. Fast bail-out: if command doesn't match `git checkout -b`, `git switch -c`, or `git branch` patterns, exit 0 immediately
4. Parse the branch name from the command
5. Check if it already contains a Linear identifier pattern (`FRG-\d+`) — if so, exit 0
6. Resolve requirement context:
   - Read `.forge/build-context.json` for current slug + reqId
   - Look up `_index.yaml` → find linearIssueId → resolve identifier
7. Rewrite the command with `updatedInput`:
   ```json
   {
     "hookSpecificOutput": {
       "hookEventName": "PreToolUse",
       "permissionDecision": "allow",
       "updatedInput": {
         "command": "git checkout -b feat/slug/FRG-132-req-001"
       }
     }
   }
   ```
8. If resolution fails, exit 0 (allow original command — don't block work)

## Interview Notes
- Must be extremely fast for non-matching commands — fires on EVERY Bash call
- Shares `resolveRequirementContext()` helper with req-001
- The hook is defensive: never block, only rewrite when confident
