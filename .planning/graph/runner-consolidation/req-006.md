---
id: req-006
title: "Build skill wires computeWaves for agent team execution"
group: Build Skill Integration
dependsOn:
  - req-001
files:
  creates: []
  modifies:
    - skills/forge-build.md
acceptance:
  - "Build skill Step 1 calls computeWaves(index) to group requirements into parallel waves"
  - "For each wave, the skill spawns builder agents in parallel via TeamCreate and Task tool"
  - "The skill removes the 'Future parallel execution will use computeWaves()' comment and replaces it with actual wave execution instructions"
  - "Sequential fallback: if a wave has only 1 requirement, it runs as a single agent (no team overhead)"
---

## Context
The build skill currently says "Execute ready[0] sequentially. Future parallel execution will use computeWaves()." The `computeWaves()` function exists and is exported from `src/graph/query.ts` but has never been wired into any execution path. The build skill should use it to enable parallel agent team execution within waves.

## Technical Approach
Update `skills/forge-build.md` Step 1 (Execution Loop):

1. Replace sequential `ready[0]` execution with wave-based execution:
   ```
   waves = computeWaves(index)
   for each wave:
     if wave has 1 requirement:
       spawn single builder agent
     else:
       create team via TeamCreate
       spawn builder agents in parallel (one per requirement in wave)
       coordinate via task list and messaging

     between waves:
       restage all files
       run npx tsc --noEmit
       reload index
   ```

2. Each builder agent gets spawned with `isolation: "worktree"` — the WorktreeCreate hook (req-001) handles branch naming and Linear sync automatically.

3. Update the Context Budget section to reflect wave-based execution.

## Interview Notes
- `computeWaves()` is implemented in `src/graph/query.ts` line 235 — returns arrays of requirement IDs grouped by dependency level
- Wave execution is the preferred model — agent teams with parallel builders
- The WorktreeCreate hook must be in place (req-001) before wave execution works correctly
