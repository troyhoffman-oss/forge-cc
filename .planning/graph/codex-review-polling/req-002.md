---
id: req-002
title: "Create ref/codex-review.md shared protocol"
group: Protocol
dependsOn:
  - req-001
files:
  creates:
    - skills/ref/codex-review.md
  modifies: []
acceptance:
  - "skills/ref/codex-review.md exists with complete Codex Review Protocol"
  - "Protocol covers: trigger condition, polling invocation, comment evaluation, fix/resolve/reply flow, return to user for merge"
  - "Protocol explicitly states agent must NEVER auto-merge"
  - "Protocol uses forge codex-poll CLI for detection and gh api for GitHub interactions"
---

## Context
All three PR-creating skills (build, quick, fix) need identical Codex review handling. Rather than duplicating instructions, create a shared reference document — the same pattern used by `ref/adversarial-review.md`.

## Technical Approach
Create `skills/ref/codex-review.md` with sections:

1. **Trigger** — When to run: after a PR is created and pushed. Skip if `GITHUB_TOKEN` is not set.
2. **Poll** — Run `npx forge codex-poll --owner {owner} --repo {repo} --pr {number}`. Parse the JSON output.
3. **Evaluate** — For each comment found:
   - Read the referenced code (use `path` from the comment)
   - Assess whether the feedback is valid using agent judgment
   - Categorize: valid (fix needed), acknowledged (no fix, explain why), or dismissed (not applicable)
4. **Fix** — For valid comments:
   - Make the code change
   - Run `npx forge verify` to ensure the fix doesn't break anything
   - Stage and commit the fix
   - Push to the PR branch
5. **Resolve** — For each comment:
   - Reply via `gh api` with what was done (fixed, acknowledged with reason, or dismissed with reason)
6. **Return** — After all comments are addressed, present a summary to the user and ask for merge approval. Never auto-merge.
7. **No Codex review** — If polling times out with no review found, skip and proceed to the summary step. This is not a failure.

## Interview Notes
- User wants the agent to use its own judgment for evaluation — no rigid rules
- User explicitly requires no auto-merge
- This protocol is referenced by skills, not executed as code
