---
id: req-003
title: "Add syncGraphProjectPlanned and CLI command"
dependsOn:
  - req-001
files:
  creates: []
  modifies:
    - src/linear/sync.ts
    - src/cli.ts
    - skills/forge-plan.md
    - tests/linear/linear.test.ts
acceptance:
  - "syncGraphProjectPlanned(client, index) transitions the Linear project to 'Planned' using category 'planned'"
  - "'npx forge linear sync-planned --slug <slug>' CLI command loads the graph index and calls syncGraphProjectPlanned"
  - "forge:plan skill Step 6 calls the CLI command after creating the project and issues in Linear"
  - "Tests verify syncGraphProjectPlanned transitions project correctly"
---

## Context

After `forge:plan` creates the Linear project and issues, the project sits in whatever default state Linear assigns (typically Backlog). There's no transition to "Planned" to signal that the project has been fully specced and is ready for execution. This is a gap in the project lifecycle: Backlog -> **Planned** -> In Progress -> In Review.

## Technical Approach

### sync.ts — new function

```typescript
/** Transition project to "Planned" after planning phase completes. */
export async function syncGraphProjectPlanned(
  client: ForgeLinearClient,
  index: GraphIndex,
): Promise<SyncResult> {
  const result = emptySyncResult();

  if (index.linear?.projectId) {
    await transitionProject(client, result, index.linear.projectId, "planned", "Planned");
  } else {
    console.warn("[forge] No Linear projectId in graph index, skipping planned transition");
  }

  return result;
}
```

This reuses the existing `transitionProject` helper and `resolveProjectStatusByCategory` with category `"planned"`.

### cli.ts — new subcommand

Add under the existing `linear` command group:

```typescript
linear
  .command('sync-planned')
  .description('Transition project to Planned after planning completes')
  .requiredOption('--slug <slug>', 'Graph slug')
  .action(async (opts: { slug: string }) => {
    const apiKey = requireApiKey();
    const projectDir = process.cwd();
    const index = await loadIndex(projectDir, opts.slug);
    if (!index.linear?.teamId) {
      console.error(JSON.stringify({ error: 'No Linear teamId in graph index' }));
      process.exit(1);
    }
    const client = new ForgeLinearClient({ apiKey, teamId: index.linear.teamId });
    const { syncGraphProjectPlanned } = await import('./linear/sync.js');
    const result = await syncGraphProjectPlanned(client, index);
    console.log(JSON.stringify(result));
  });
```

### skills/forge-plan.md — update Step 6

After the existing Linear project/issue creation in Step 6, add:

```
6. **Transition project to Planned:**
   ```bash
   npx forge linear sync-planned --slug {slug}
   ```
```

This ensures the project moves from Backlog to Planned after all issues are synced.

### Tests

Add a test for `syncGraphProjectPlanned` in `tests/linear/linear.test.ts`. Since this is a sync function (not a client method), it may need its own describe block or could be tested by importing `syncGraphProjectPlanned` and mocking the client. Follow the same pattern as the existing client tests but test the sync function's behavior.

Note: The import of `syncGraphProjectPlanned` in cli.ts uses dynamic `import()` to avoid circular dependency issues and to keep the sync module lazy-loaded.

## Interview Notes

- User chose CLI command approach over skill-instruction-only
- categoryToName already includes `planned: "Planned"` so no mapping change needed
- The `transitionProject` helper and `resolveProjectStatusByCategory` already exist and handle the "planned" category
