---
id: req-002
title: "Add getIssueIdentifier and attachIssueBranch to ForgeLinearClient"
dependsOn: []
files:
  creates: []
  modifies:
    - src/linear/client.ts
    - tests/linear/linear.test.ts
acceptance:
  - "getIssueIdentifier(issueId) resolves a Linear issue UUID to its human-readable identifier (e.g. 'FRG-42') and returns it as a string"
  - "attachIssueBranch(issueId, branchName) calls the Linear API to associate a git branch with the issue"
  - "Both methods return LinearResult types, degrading gracefully on API errors"
  - "Tests verify success, null payload, and API error cases for both methods"
---

## Context

Linear's GitHub automation matches PRs to issues by finding issue identifiers (like FRG-42) in branch names or PR bodies. Forge currently creates branches using only the requirement ID (e.g., `feat/slug/REQ-001`), which Linear can't match.

To enable the automation, we need two new client methods:
1. `getIssueIdentifier` — resolves a Linear issue UUID to the human-readable identifier (e.g., "FRG-42")
2. `attachIssueBranch` — explicitly links a branch to an issue via the Linear API (belt-and-suspenders with branch naming)

## Technical Approach

### getIssueIdentifier

```typescript
async getIssueIdentifier(issueId: string): Promise<LinearResult<string>> {
  try {
    const issue = await this.client.issue(issueId);
    return { success: true, data: issue.identifier };
  } catch (err) {
    return wrapError(err);
  }
}
```

The `@linear/sdk` `LinearClient.issue(id)` method returns an `Issue` object with an `identifier` field (the "TEAM-123" string).

### attachIssueBranch

The Linear SDK's `updateIssue` method accepts a `branchName` field. This is the simplest approach — no need for `attachmentCreate`:

```typescript
async attachIssueBranch(
  issueId: string,
  branchName: string,
): Promise<LinearResult<void>> {
  try {
    await this.client.updateIssue(issueId, { branchName });
    return { success: true, data: undefined };
  } catch (err) {
    return wrapError(err);
  }
}
```

Setting `branchName` on an issue tells Linear which branch is associated with the issue. When a PR is opened from that branch, Linear's GitHub integration picks it up automatically.

### Mock setup for tests

The existing mock in `tests/linear/linear.test.ts` already mocks `LinearClient`. Add `issue` to the mock factory:

```typescript
issue: vi.fn(),
```

Then add test cases following the existing pattern:
- `getIssueIdentifier` success: mock returns `{ identifier: "FRG-42" }`, verify result
- `getIssueIdentifier` error: mock rejects, verify error wrapping
- `attachIssueBranch` success: mock `updateIssue` resolves, verify `branchName` was passed
- `attachIssueBranch` error: mock rejects, verify error wrapping

## Interview Notes

- User specified checking the Linear SDK for branch linking — confirmed `updateIssue({ branchName })` is the right approach
- These methods are used by REQ-004 (runner integration) to wire branch naming and linking into the execution flow
